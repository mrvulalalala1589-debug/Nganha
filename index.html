<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Galaxy Hand Gallery</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: radial-gradient(circle at center, #07002a, #000);
  font-family: Arial, sans-serif;
  touch-action: none;
}

#status {
  position: fixed;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  color: #0ff;
  font-size: 14px;
  z-index: 10;
  background: rgba(0,0,0,0.4);
  padding: 6px 14px;
  border-radius: 20px;
}

#gallery {
  position: absolute;
  width: 100%;
  height: 100%;
}

.photo {
  position: absolute;
  top: 50%;
  left: 50%;
  max-width: 80%;
  max-height: 80%;
  transform: translate(-50%, -50%) scale(0.9);
  opacity: 0;
  transition: opacity 0.45s ease, transform 0.45s ease;
  pointer-events: none;
}

.photo.active {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.05);
}
</style>
</head>

<body>
<div id="status">ğŸŒŒ Äang khá»Ÿi Ä‘á»™ngâ€¦</div>
<div id="gallery"></div>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ================= CONFIG ================= */
const imageFiles = [
  'space1.png','space2.png','space3.png','space4.png','space5.png',
  'space6.png','space7.png','space8.png','space9.png','space10.png'
];

const SWIPE_THRESHOLD = 35;   // Ä‘á»™ nháº¡y lÆ°á»›t
const HAND_COOLDOWN = 350;    // ms chá»‘ng lÆ°á»›t quÃ¡ nhanh

/* ================= STATE ================= */
let currentIndex = 0;
let lastX = null;
let lastChangeTime = 0;
let usingHand = false;

/* ================= LOAD IMAGES ================= */
const gallery = document.getElementById('gallery');
const statusDiv = document.getElementById('status');
const photos = [];

imageFiles.forEach((src, i) => {
  const img = document.createElement('img');
  img.src = src;
  img.className = 'photo' + (i === 0 ? ' active' : '');
  gallery.appendChild(img);
  photos.push(img);
});

function showImage(index) {
  photos.forEach(p => p.classList.remove('active'));
  photos[index].classList.add('active');
}

/* ================= IMAGE CHANGE ================= */
function nextImage(dir) {
  const now = Date.now();
  if (now - lastChangeTime < HAND_COOLDOWN) return;
  lastChangeTime = now;

  currentIndex += dir;
  if (currentIndex < 0) currentIndex = photos.length - 1;
  if (currentIndex >= photos.length) currentIndex = 0;
  showImage(currentIndex);
}

/* ================= MOVE HANDLER ================= */
function handleMove(x) {
  if (lastX === null) {
    lastX = x;
    return;
  }
  const dx = x - lastX;
  if (Math.abs(dx) > SWIPE_THRESHOLD) {
    nextImage(dx > 0 ? 1 : -1);
    lastX = x;
  }
}

/* ================= MOUSE ================= */
window.addEventListener('mousedown', e => {
  usingHand = false;
  lastX = e.clientX;
  statusDiv.innerText = "ğŸ–±ï¸ Giá»¯ & kÃ©o chuá»™t Ä‘á»ƒ lÆ°á»›t áº£nh";
});
window.addEventListener('mousemove', e => {
  if (lastX !== null) handleMove(e.clientX);
});
window.addEventListener('mouseup', () => lastX = null);

/* ================= TOUCH ================= */
window.addEventListener('touchstart', e => {
  usingHand = false;
  lastX = e.touches[0].clientX;
  statusDiv.innerText = "ğŸ‘† Vuá»‘t Ä‘á»ƒ lÆ°á»›t áº£nh";
});
window.addEventListener('touchmove', e => {
  handleMove(e.touches[0].clientX);
});
window.addEventListener('touchend', () => lastX = null);

/* ================= HAND TRACKING ================= */
const video = document.createElement('video');

const hands = new Hands({
  locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

hands.onResults(results => {
  if (!results.multiHandLandmarks.length) return;

  usingHand = true;
  const lm = results.multiHandLandmarks[0];
  const x = lm[8].x * window.innerWidth; // Ä‘áº§u ngÃ³n trá»
  handleMove(x);

  statusDiv.innerText = "âœ‹ Di chuyá»ƒn tay Ä‘á»ƒ lÆ°á»›t áº£nh";
});

/* ================= CAMERA ================= */
(async () => {
  try {
    const camera = new Camera(video, {
      onFrame: async () => {
        await hands.send({ image: video });
      },
      width: 640,
      height: 480
    });
    await camera.start();
    statusDiv.innerText = "ğŸ“· Camera sáºµn sÃ ng â€“ xoay tay Ä‘á»ƒ xem áº£nh";
  } catch (e) {
    statusDiv.innerText = "ğŸ‘† Vuá»‘t / kÃ©o Ä‘á»ƒ xem áº£nh (khÃ´ng cÃ³ camera)";
  }
})();
</script>
</body>
</html>
